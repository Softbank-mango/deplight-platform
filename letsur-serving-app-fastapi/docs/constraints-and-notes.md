# 제약사항 및 주요 유의사항

이 문서는 FastAPI 템플릿을 사용하여 애플리케이션을 개발할 때 반드시 숙지해야 할 제약사항과 주요 유의사항들을 설명합니다.

---

### 1. `/invocations` API 경로의 특별한 의미

API 라우터의 경로(path)를 `/invocations`로 설정하는 경우, 이 엔드포인트는 사내 `StaiX` 플랫폼과 특별한 방식으로 연동됩니다.

*   **`StaiX` UI 연동**: `StaiX` UI의 "테스트 호출" 기능은 `/invocations` 경로를 가진 엔드포인트를 대상으로 동작합니다. 다른 경로(e.g., `/predict`)를 사용할 경우, UI를 통한 테스트 호출이 정상적으로 작동하지 않을 수 있습니다.
*   **사용량 집계**: `StaiX` 플랫폼의 모델/엔드포인트 사용량 집계 시스템은 `/invocations` 경로로 들어온 요청을 기준으로 카운트합니다.

> **권장 사항:**
> 특별한 이유가 없다면, 메인 추론 API의 경로는 `/invocations`로 설정하는 것을 권장합니다.

---

### 2. `@lamp_invocation` 데코레이터 유의사항

#### 2.1. `wait`와 `timeout` 파라미터의 역할

`@lamp_invocation` 데코레이터에 설정하는 `wait`와 `timeout` 값은 서버의 실제 동작을 제어하지 않습니다.

*   **역할**: 이 값들은 API 명세(`openapi.json`)에 포함되어, 이 API를 호출하는 **클라이언트에게 "이 정도 시간을 기다리는 것이 좋다"라고 알려주는 메타데이터** 역할만 합니다.
*   **서버 동작**: 서버는 이 값과 무관하게 요청을 처리하며, 실제 타임아웃은 클러스터의 설정이나 인프라 레벨에서 관리됩니다.

#### 2.2. `use_async=True` 옵션과 비동기 엔드포인트 생성

`@lamp_invocation(use_async=True)` 옵션을 활성화하면, 기존에 정의한 동기 API 엔드포인트 외에 **비동기 처리를 위한 별도의 엔드포인트가 자동으로 생성**됩니다.

*   **자동 생성 경로**: 원래 정의한 경로 뒤에 `/async`가 추가된 경로로 생성됩니다.
    *   예시: `@router.post("/invocations")`에 `use_async=True`를 적용하면,
        *   동기 API: `POST /invocations`
        *   비동기 API: `POST /invocations/async`
    *   두 개의 엔드포인트가 모두 활성화됩니다.

---

### 3. 비동기(Async) 처리의 내부 아키텍처

`use_async=True` 옵션을 통해 실행되는 비동기 작업의 내부 인프라는 다음과 같이 구성되어 있습니다.

*   **메시지 브로커 (Celery Broker)**: 비동기 작업 요청을 담는 큐(Queue)는 **AWS SQS (Simple Queue Service)**를 사용합니다.
*   **결과 백엔드 (Result Backend)**: 비동기 작업의 결과물은 **AWS S3** 버킷(`letsur-api-async`)에 저장됩니다.

이는 애플리케이션의 코드가 아닌, 사내 플랫폼 인프라 레벨에서 설정 및 관리됩니다. 사용자는 이 내부 구조를 직접 제어할 필요는 없지만, 비동기 처리의 흐름을 이해하는 데 도움이 될 수 있습니다.
