<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delightful Deploy - ì„œë¹„ìŠ¤ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .service-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        .status-healthy {
            background-color: #10b981;
            box-shadow: 0 0 8px #10b981;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .user-menu {
            position: absolute;
            top: 60px;
            right: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 50;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // API ê¸°ë³¸ URL
        const API_BASE_URL = window.location.origin;

        // ì„œë¹„ìŠ¤ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
        function ServiceCard({ service }) {
            const getStatusColor = (status) => {
                switch(status) {
                    case 'healthy': return 'text-green-600';
                    case 'deploying': return 'text-yellow-600';
                    case 'error': return 'text-red-600';
                    default: return 'text-gray-600';
                }
            };

            const getStatusText = (status) => {
                switch(status) {
                    case 'healthy': return 'ì‹¤í–‰ ì¤‘';
                    case 'deploying': return 'ë°°í¬ ì¤‘';
                    case 'error': return 'ì˜¤ë¥˜';
                    default: return 'ì•Œ ìˆ˜ ì—†ìŒ';
                }
            };

            const handleStartApp = () => {
                if (service.url) {
                    window.open(service.url, '_blank');
                }
            };

            return (
                <div className="bg-white rounded-lg p-6 card-hover cursor-pointer">
                    <div className="flex items-start justify-between mb-4">
                        <div className="flex items-center">
                            <div className="service-icon w-12 h-12 rounded-lg flex items-center justify-center text-white font-bold text-xl mr-4">
                                {service.name.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <h3 className="text-lg font-semibold text-gray-900">{service.name}</h3>
                                <p className="text-sm text-gray-500">{service.description || 'ë°°í¬ëœ ì„œë¹„ìŠ¤'}</p>
                            </div>
                        </div>
                        <div className={`text-sm font-medium ${getStatusColor(service.status)}`}>
                            <span className={`status-dot ${service.status === 'healthy' ? 'status-healthy' : ''}`}></span>
                            {getStatusText(service.status)}
                        </div>
                    </div>

                    <div className="mb-4">
                        <div className="text-sm text-gray-600 mb-2">
                            <span className="font-medium">í”„ë ˆì„ì›Œí¬:</span> {service.framework || 'N/A'}
                        </div>
                        <div className="text-sm text-gray-600 mb-2">
                            <span className="font-medium">ì–¸ì–´:</span> {service.language || 'N/A'}
                        </div>
                        <div className="text-sm text-gray-600 mb-2">
                            <span className="font-medium">ë°°í¬ ì‹œê°:</span> {service.deployedAt ? new Date(service.deployedAt).toLocaleString('ko-KR') : 'N/A'}
                        </div>
                        <div className="text-sm text-gray-600">
                            <span className="font-medium">ì»¤ë°‹:</span> {service.commitSha?.substring(0, 7) || 'N/A'}
                        </div>
                    </div>

                    <button
                        onClick={handleStartApp}
                        disabled={service.status !== 'healthy'}
                        className={`w-full py-3 px-4 rounded-lg font-medium transition-colors ${
                            service.status === 'healthy'
                                ? 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:from-purple-700 hover:to-indigo-700'
                                : 'bg-gray-200 text-gray-500 cursor-not-allowed'
                        }`}
                    >
                        {service.status === 'healthy' ? 'ì•± ì‹œì‘í•˜ê¸°' : 'ì‚¬ìš© ë¶ˆê°€'}
                    </button>
                </div>
            );
        }

        // í—¤ë” ì»´í¬ë„ŒíŠ¸
        function Header({ onUserMenuToggle, showUserMenu }) {
            return (
                <div className="bg-white shadow-sm mb-8">
                    <div className="container mx-auto px-6 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center">
                                <h1 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">
                                    Delightful Deploy
                                </h1>
                            </div>
                            <div className="flex items-center space-x-4">
                                <a
                                    href="/deploy.html"
                                    className="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-6 py-2 rounded-lg font-medium hover:from-purple-700 hover:to-indigo-700 transition-colors flex items-center space-x-2"
                                >
                                    <span>ğŸš€</span>
                                    <span>ìƒˆ ë°°í¬</span>
                                </a>
                                <div className="text-sm text-gray-600">
                                    <span className="font-medium">ì›Œí¬ìŠ¤í˜ì´ìŠ¤:</span> Production
                                </div>
                                <button
                                    onClick={onUserMenuToggle}
                                    className="flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 rounded-full px-4 py-2 transition-colors"
                                >
                                    <div className="w-8 h-8 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold">
                                        A
                                    </div>
                                    <span className="text-sm font-medium text-gray-700">Admin</span>
                                    <svg className={`w-4 h-4 text-gray-500 transition-transform ${showUserMenu ? 'rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // ì‚¬ìš©ì ë©”ë‰´ ì»´í¬ë„ŒíŠ¸
        function UserMenu({ show }) {
            if (!show) return null;

            return (
                <div className="user-menu w-64 py-2">
                    <div className="px-4 py-3 border-b border-gray-200">
                        <div className="text-sm font-medium text-gray-900">Administrator</div>
                        <div className="text-xs text-gray-500 mt-1">admin@delightful.dev</div>
                    </div>
                    <div className="py-2">
                        <a href="#" className="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <span className="inline-block w-5 mr-2">âš™ï¸</span>
                            ì„¤ì •
                        </a>
                        <a href="#" className="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <span className="inline-block w-5 mr-2">ğŸ‘¤</span>
                            í”„ë¡œí•„
                        </a>
                        <a href="#" className="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <span className="inline-block w-5 mr-2">ğŸ“Š</span>
                            ëŒ€ì‹œë³´ë“œ
                        </a>
                    </div>
                    <div className="border-t border-gray-200 py-2">
                        <a href="#" className="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
                            <span className="inline-block w-5 mr-2">ğŸšª</span>
                            ë¡œê·¸ì•„ì›ƒ
                        </a>
                    </div>
                </div>
            );
        }

        // ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì»´í¬ë„ŒíŠ¸
        function Dashboard() {
            const [services, setServices] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [showUserMenu, setShowUserMenu] = useState(false);

            // APIì—ì„œ ì„œë¹„ìŠ¤ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const fetchServices = async () => {
                try {
                    setLoading(true);
                    setError(null);

                    const response = await fetch(`${API_BASE_URL}/api/services`);
                    const data = await response.json();

                    if (data.success) {
                        setServices(data.services);
                    } else {
                        throw new Error(data.error || 'Failed to fetch services');
                    }
                } catch (err) {
                    console.error('Error fetching services:', err);
                    setError(err.message);

                    // í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ ë°ì´í„°
                    setServices([
                        {
                            id: '1',
                            name: 'test-fastapi-app',
                            description: 'FastAPI Application',
                            framework: 'FastAPI',
                            language: 'Python',
                            status: 'healthy',
                            deployedAt: new Date().toISOString(),
                            commitSha: 'bcd6c2f4',
                            url: 'http://delightful-deploy-alb-52260314.ap-northeast-2.elb.amazonaws.com'
                        }
                    ]);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchServices();
                // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
                const interval = setInterval(fetchServices, 30000);
                return () => clearInterval(interval);
            }, []);

            const handleUserMenuToggle = () => {
                setShowUserMenu(!showUserMenu);
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"></div>
                            <div className="text-white text-lg">ì„œë¹„ìŠ¤ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen">
                    <Header onUserMenuToggle={handleUserMenuToggle} showUserMenu={showUserMenu} />
                    <UserMenu show={showUserMenu} />

                    <div className="container mx-auto px-6 py-8">
                        <div className="mb-8">
                            <h2 className="text-3xl font-bold text-white mb-2">ë°°í¬ëœ ì„œë¹„ìŠ¤</h2>
                            <p className="text-purple-100">
                                ì´ {services.length}ê°œì˜ ì„œë¹„ìŠ¤ê°€ ë°°í¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
                            </p>
                        </div>

                        {error && (
                            <div className="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded">
                                <p className="font-medium">ì£¼ì˜: API ì—°ê²° ì‹¤íŒ¨</p>
                                <p className="text-sm mt-1">í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                            </div>
                        )}

                        {services.length === 0 ? (
                            <div className="bg-white rounded-lg p-12 text-center">
                                <div className="text-6xl mb-4">ğŸš€</div>
                                <h3 className="text-xl font-semibold text-gray-900 mb-2">
                                    ì•„ì§ ë°°í¬ëœ ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤
                                </h3>
                                <p className="text-gray-600 mb-6">
                                    Gitì— ì½”ë“œë¥¼ pushí•˜ë©´ ìë™ìœ¼ë¡œ ë¶„ì„ë˜ê³  ë°°í¬ë©ë‹ˆë‹¤!
                                </p>
                                <button className="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:from-purple-700 hover:to-indigo-700">
                                    ë°°í¬ ê°€ì´ë“œ ë³´ê¸°
                                </button>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {services.map(service => (
                                    <ServiceCard key={service.id} service={service} />
                                ))}
                            </div>
                        )}

                        <div className="mt-8 text-center">
                            <button
                                onClick={fetchServices}
                                className="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-6 py-2 rounded-lg font-medium transition-colors backdrop-blur-sm"
                            >
                                ğŸ”„ ìƒˆë¡œê³ ì¹¨
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // ì•± ë Œë”ë§
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>
</html>
